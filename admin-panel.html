<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å—è–º–∏</title>
</head>
<body>
    <div class="admin-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <!--<div class="sidebar">
            <div class="sidebar-header">
                <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</p>
            </div>
            <div class="nav-menu">
                <div class="nav-item active">
                    <i>üìù</i> –°—Ç–∞—Ç—å–∏
                </div>
                <div class="nav-item">
                    <i>üë•</i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </div>
                <div class="nav-item">
                    <i>‚öôÔ∏è</i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </div>
            </div>
        </div>-->
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="main-content">
            <div class="admin-header">
                <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å—è–º–∏</h1>
                <div class="buttons">
                    <button class="btn btn-primary" id="addArticleBtn">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</button>
                    <button class="btn btn-danger" id="closeAdminPanel">–í—ã–π—Ç–∏</button>
                </div>
            </div>
            
            <div id="alertMessage" class="alert alert-success" style="display: none;"></div>
            
            <div class="articles-list">
                <div class="table-header">
                    <div class="col-id">ID</div>
                    <div class="col-title">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
                    <div class="col-date">–î–∞—Ç–∞</div>
                    <div class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</div>
                </div>
                <div id="articlesContainer">
                    <!-- –°—Ç–∞—Ç—å–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏ -->
    <div class="modal" id="articleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</h3>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="articleForm">
                    <input type="hidden" id="articleId">
                    <div class="form-group">
                        <label for="articleTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</label>
                        <input type="text" id="articleTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="articleContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                        <textarea id="articleContent" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveArticleBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="/services/close_admin_panel.js"></script>
    
    <script>
        // –ò–º–∏—Ç–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage)
        const db = {
            getArticles: () => {
                const articles = localStorage.getItem('articles');
                return articles ? JSON.parse(articles) : [];
            },
            saveArticle: (article) => {
                const articles = db.getArticles();
                if (article.id) {
                    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞—Ç—å–∏
                    const index = articles.findIndex(a => a.id === article.id);
                    if (index !== -1) {
                        articles[index] = article;
                    }
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏
                    article.id = Date.now(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º timestamp –∫–∞–∫ ID
                    article.createdAt = new Date().toISOString();
                    articles.push(article);
                }
                localStorage.setItem('articles', JSON.stringify(articles));
                return article;
            },
            deleteArticle: (id) => {
                const articles = db.getArticles().filter(a => a.id !== id);
                localStorage.setItem('articles', JSON.stringify(articles));
            }
        };
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const articlesContainer = document.getElementById('articlesContainer');
        const addArticleBtn = document.getElementById('addArticleBtn');
        const articleModal = document.getElementById('articleModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveArticleBtn = document.getElementById('saveArticleBtn');
        const articleForm = document.getElementById('articleForm');
        const modalTitle = document.getElementById('modalTitle');
        const articleId = document.getElementById('articleId');
        const articleTitle = document.getElementById('articleTitle');
        const articleContent = document.getElementById('articleContent');
        const alertMessage = document.getElementById('alertMessage');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadArticles() {
            const articles = db.getArticles();
            articlesContainer.innerHTML = '';
            
            if (articles.length === 0) {
                articlesContainer.innerHTML = '<div class="table-row" style="justify-content: center; padding: 30px;">–°—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            articles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.className = 'table-row';
                articleElement.innerHTML = `
                    <div class="col-id">${article.id}</div>
                    <div class="col-title">${article.title}</div>
                    <div class="col-date">${formatDate(article.createdAt)}</div>
                    <div class="col-actions">
                        <button class="action-btn edit" data-id="${article.id}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-btn delete" data-id="${article.id}">–£–¥–∞–ª–∏—Ç—å</button>
                        <button class="action-btn publish" data-id="${article.id}">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–∞–π—Ç</button>
                    </div>
                `;
                articlesContainer.appendChild(articleElement);
            });
            
            // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', () => editArticle(parseInt(btn.dataset.id)));
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', () => deleteArticle(parseInt(btn.dataset.id)));
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å–∏
        function openAddArticleModal() {
            modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é';
            articleId.value = '';
            articleForm.reset();
            articleModal.style.display = 'flex';
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏
        function editArticle(id) {
            const article = db.getArticles().find(a => a.id === id);
            if (article) {
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é';
                articleId.value = article.id;
                articleTitle.value = article.title;
                articleContent.value = article.content;
                articleModal.style.display = 'flex';
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏
        function deleteArticle(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é?')) {
                db.deleteArticle(id);
                loadArticles();
                showAlert('–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏
        function saveArticle() {
            if (!articleTitle.value.trim() || !articleContent.value.trim()) {
                alert('–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
                return;
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            if (articleId.value) {
                const originalArticle = db.getArticles().find(a => a.id === parseInt(articleId.value));
                
                if (originalArticle && 
                    originalArticle.title === articleTitle.value.trim() && 
                    originalArticle.content === articleContent.value.trim()) {
                    return;
                }
            }
            const article = {
                id: articleId.value ? parseInt(articleId.value) : null,
                title: articleTitle.value,
                content: articleContent.value,
            };
            db.saveArticle(article);
            loadArticles();
            articleModal.style.display = 'none';
            showAlert(article.id ? '–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        }

        function formatDate(dateString) {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                /*hour: '2-digit',
                minute: '2-digit'*/
            };
            
            try {
                const date = dateString ? new Date(dateString) : new Date();
                return isNaN(date.getTime()) ? '–ù–µ—Ç –¥–∞—Ç—ã' : date.toLocaleString('ru-RU', options);
            } catch (e) {
                return '–ù–µ—Ç –¥–∞—Ç—ã';
            }
        }

        // –í loadArticles() –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        document.querySelectorAll('.action-btn.publish').forEach(btn => {
            btn.addEventListener('click', () => publishArticle(parseInt(btn.dataset.id)));
        });
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert(message) {
            alertMessage.textContent = message;
            alertMessage.style.display = 'block';
            setTimeout(() => {
                alertMessage.style.display = 'none';
            }, 3000);
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            articleModal.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç—å–∏
        function publishArticle(id) {
            const articles = db.getArticles();
            const article = articles.find(a => a.id === id);
            
            if (article) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é
                const publishedArticles = JSON.parse(localStorage.getItem('publishedArticles') || []);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –ª–∏ —É–∂–µ —ç—Ç–∞ —Å—Ç–∞—Ç—å—è
                if (!publishedArticles.some(a => a.id === id)) {
                    publishedArticles.push(article);
                    localStorage.setItem('publishedArticles', JSON.stringify(publishedArticles));
                    showAlert('–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –Ω–∞ —Å–∞–π—Ç–µ');
                } else {
                    showAlert('–≠—Ç–∞ —Å—Ç–∞—Ç—å—è —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞', 'error');
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        addArticleBtn.addEventListener('click', openAddArticleModal);
        closeModalBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        saveArticleBtn.addEventListener('click', saveArticle);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', (e) => {
            if (e.target === articleModal) {
                closeModal();
            }
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadArticles);
    </script>
</body>
</html>